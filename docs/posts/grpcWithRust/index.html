<!DOCTYPE html><html lang="en-us" q:render="static-ssr" q:container="paused" q:version="1.2.6" q:base="/build/" q:locale q:manifest-hash="3d4jae"><!--qv q:id=0 q:key=3scc:pY_0--><!--qv q:id=1 q:key=TxCF:35_3--><!--qv q:s q:sref=1 q:key=--><head q:head><meta charSet="utf-8" q:head><title q:head>N1ll</title><link href="/manifest.json" rel="manifest" q:head><meta content="width=device-width, initial-scale=1.0" name="viewport" q:head><meta content="A personal blog about programming and writing" name="description" q:head><!--qv q:key=35_0--><script q:key="0b_0" q:head>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/partytown/"});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.8.2 - MIT builder.io */
!function(t,e,n,i,o,r,a,s,d,c,l,p){function u(){p||(p=1,"/"==(a=(r.lib||"/~partytown/")+(r.debug?"debug/":""))[0]&&(d=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(s=setTimeout(f,1e4),e.addEventListener("pt0",w),o?h(1):n.serviceWorker?n.serviceWorker.register(a+(r.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):f())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.style.display="block",c.style.width="0",c.style.height="0",c.style.border="0",c.style.visibility="hidden",c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.8.2":"sandbox-sw.html?"+Date.now()),e.querySelector(r.sandboxParent||"body").appendChild(c)}function f(n,o){for(w(),i==t&&(r.forward||[]).map((function(e){delete t[e.split(".")[0]]})),n=0;n<d.length;n++)(o=e.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=r.nonce,e.head.appendChild(o);c&&c.parentNode.removeChild(c)}function w(){clearTimeout(s)}r=t.partytown||{},i==t&&(r.forward||[]).map((function(e){l=t,e.split(".").map((function(e,n,i){l=l[i[n]]=n+1<i.length?"push"==i[n+1]?[]:l[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);</script><!--/qv--><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FSZE01YQC3" type="text/partytown" q:head></script><link rel="stylesheet" href="/build/q-bac85e75.css"><style q:style="lcydw1-0" hidden>:root{view-transition-name:none}</style></head><body lang="en"><!--qv q:id=2 q:key=e0ss:35_1--><!--qv q:key=zl_1--><!--qv q:id=3 q:key=VkLN:zl_0--><div class="grid grid-cols-1 gap-4 px-10 mt-7 w-full md:max-w-5xl md:mx-auto dark" q:key="XF_1"><main><!--qv q:s q:sref=3 q:key=--><!--qv q:id=4 q:key=nO36:zl_0--><style q:style="pe5i3o-0" hidden>pre{border:1px solid tomato}
</style><style q:style="cbenux-1" hidden>code[class*=language-],pre[class*=language-]{color:#abb2bf;text-shadow:0 1px rgba(0,0,0,.3);font-family:Fira Code,Fira Mono,Menlo,Consolas,DejaVu Sans Mono,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] *::-moz-selection,pre[class*=language-] *::-moz-selection{background:hsl(220,13%,28%);color:inherit;text-shadow:none}code[class*=language-]::selection,code[class*=language-] *::selection,pre[class*=language-] *::selection{background:hsl(220,13%,28%);color:inherit;text-shadow:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-]{padding:.2em .3em;border-radius:.3em;white-space:normal}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}.token.comment,.token.prolog,.token.cdata{color:#5c6370}.token.doctype,.token.punctuation,.token.entity{color:#abb2bf}.token.attr-name,.token.class-name,.token.boolean,.token.constant,.token.number,.token.atrule{color:#d19a66}.token.keyword{color:#c678dd}.token.property,.token.tag,.token.symbol,.token.deleted,.token.important{color:#e06c75}.token.selector,.token.string,.token.char,.token.builtin,.token.inserted,.token.regex,.token.attr-value,.token.attr-value>.token.punctuation{color:#98c379}.token.variable,.token.operator,.token.function{color:#61afef}.token.url{color:#56b6c2}.token.attr-value>.token.punctuation.attr-equals,.token.special-attr>.token.attr-value>.token.value.css{color:#abb2bf}.language-css .token.selector{color:#e06c75}.language-css .token.property{color:#abb2bf}.language-css .token.function,.language-css .token.url>.token.function{color:#56b6c2}.language-css .token.url>.token.string.url{color:#98c379}.language-css .token.important,.language-css .token.atrule .token.rule,.language-javascript .token.operator{color:#c678dd}.language-javascript .token.template-string>.token.interpolation>.token.interpolation-punctuation.punctuation{color:#be5046}.language-json .token.operator{color:#abb2bf}.language-json .token.null.keyword{color:#d19a66}.language-markdown .token.url,.language-markdown .token.url>.token.operator,.language-markdown .token.url-reference.url>.token.string{color:#abb2bf}.language-markdown .token.url>.token.content{color:#61afef}.language-markdown .token.url>.token.url,.language-markdown .token.url-reference.url{color:#56b6c2}.language-markdown .token.blockquote.punctuation,.language-markdown .token.hr.punctuation{color:#5c6370;font-style:italic}.language-markdown .token.code-snippet{color:#98c379}.language-markdown .token.bold .token.content{color:#d19a66}.language-markdown .token.italic .token.content{color:#c678dd}.language-markdown .token.strike .token.content,.language-markdown .token.strike .token.punctuation,.language-markdown .token.list.punctuation,.language-markdown .token.title.important>.token.punctuation{color:#e06c75}.token.bold{font-weight:700}.token.comment{color:#0ffc03}.token.comment,.token.italic{font-style:italic}.token.entity{cursor:help}.token.namespace{opacity:.8}.token.token.tab:not(:empty):before,.token.token.cr:before,.token.token.lf:before,.token.token.space:before{color:#abb2bf26;text-shadow:none}div.code-toolbar>.toolbar.toolbar>.toolbar-item{margin-right:.4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>button,div.code-toolbar>.toolbar.toolbar>.toolbar-item>a,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span{background:hsl(220,13%,26%);color:#828997;padding:.1em .4em;border-radius:.3em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:focus{background:hsl(220,13%,28%);color:#abb2bf}.line-highlight.line-highlight{background:hsla(220,100%,80%,.04)}.line-highlight.line-highlight:before,.line-highlight.line-highlight[data-end]:after{background:hsl(220,13%,26%);color:#abb2bf;padding:.1em .6em;border-radius:.3em;box-shadow:0 2px #0003}pre[id].linkable-line-numbers.linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:#99bbff0a}.line-numbers.line-numbers .line-numbers-rows,.command-line .command-line-prompt{border-right-color:#abb2bf26}.line-numbers .line-numbers-rows>span:before,.command-line .command-line-prompt>span:before{color:#636d83}.rainbow-braces .token.token.punctuation.brace-level-1,.rainbow-braces .token.token.punctuation.brace-level-5,.rainbow-braces .token.token.punctuation.brace-level-9{color:#e06c75}.rainbow-braces .token.token.punctuation.brace-level-2,.rainbow-braces .token.token.punctuation.brace-level-6,.rainbow-braces .token.token.punctuation.brace-level-10{color:#98c379}.rainbow-braces .token.token.punctuation.brace-level-3,.rainbow-braces .token.token.punctuation.brace-level-7,.rainbow-braces .token.token.punctuation.brace-level-11{color:#61afef}.rainbow-braces .token.token.punctuation.brace-level-4,.rainbow-braces .token.token.punctuation.brace-level-8,.rainbow-braces .token.token.punctuation.brace-level-12{color:#c678dd}pre.diff-highlight>code .token.token.deleted:not(.prefix),pre>code.diff-highlight .token.token.deleted:not(.prefix){background-color:#ff526626}pre.diff-highlight>code .token.token.deleted:not(.prefix)::-moz-selection,pre.diff-highlight>code .token.token.deleted:not(.prefix) *::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) *::-moz-selection{background-color:#fb566940}pre.diff-highlight>code .token.token.deleted:not(.prefix)::selection,pre.diff-highlight>code .token.token.deleted:not(.prefix) *::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) *::selection{background-color:#fb566940}pre.diff-highlight>code .token.token.inserted:not(.prefix),pre>code.diff-highlight .token.token.inserted:not(.prefix){background-color:#1aff5b26}pre.diff-highlight>code .token.token.inserted:not(.prefix)::-moz-selection,pre.diff-highlight>code .token.token.inserted:not(.prefix) *::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) *::-moz-selection{background-color:#38e06240}pre.diff-highlight>code .token.token.inserted:not(.prefix)::selection,pre.diff-highlight>code .token.token.inserted:not(.prefix) *::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) *::selection{background-color:#38e06240}.prism-previewer.prism-previewer:before,.prism-previewer-gradient.prism-previewer-gradient div{border-color:#262931}.prism-previewer-color.prism-previewer-color:before,.prism-previewer-gradient.prism-previewer-gradient div,.prism-previewer-easing.prism-previewer-easing:before{border-radius:.3em}.prism-previewer.prism-previewer:after{border-top-color:#262931}.prism-previewer-flipped.prism-previewer-flipped.after{border-bottom-color:#262931}.prism-previewer-angle.prism-previewer-angle:before,.prism-previewer-time.prism-previewer-time:before,.prism-previewer-easing.prism-previewer-easing{background:hsl(219,13%,22%)}.prism-previewer-angle.prism-previewer-angle circle,.prism-previewer-time.prism-previewer-time circle{stroke:#abb2bf;stroke-opacity:1}.prism-previewer-easing.prism-previewer-easing circle,.prism-previewer-easing.prism-previewer-easing path,.prism-previewer-easing.prism-previewer-easing line{stroke:#abb2bf}.prism-previewer-easing.prism-previewer-easing circle{fill:transparent}
</style><style q:style="ikgwqs-2" hidden>pre{overflow-x:scroll}.code-highlight{float:left;min-width:100%}.code-line{display:block;padding-left:16px;padding-right:16px;margin-left:-16px;margin-right:-16px;border-left:4px solid rgba(0,0,0,0)}.code-line.inserted{background-color:#10b98133}.code-line.deleted{background-color:#ef444433}.highlight-line{margin-left:-16px;margin-right:-16px;background-color:#37415180;border-left:4px solid rgb(59,130,246)}.line-number:before{display:inline-block;width:1rem;text-align:right;margin-right:16px;margin-left:-8px;color:#9ca3af;content:attr(line)}
</style><div class="grid grid-cols-1 md:grid-cols-[1fr_800px_1.2fr] gap-4" q:key="p5_1"><div></div><article class="prose prose-base dark:prose-invert p-4 overflow-x-hidden ::selection:bg-fuchsia-700"><!--qv q:s q:sref=4 q:key=--><!--qv q:key=v3Kz-9vL--><h1 id="a-short-journey-into-grpc-with-rust"><a aria-hidden="true" tabindex="-1" href="#a-short-journey-into-grpc-with-rust"><span class="icon icon-link"></span></a>A short journey into gRPC with Rust</h1>
<p>I use <code>tokio</code> and <code>seaORM</code> to build a simple CRUD gRPC app. Here is what I got from the process.</p>
<h2 id="trait-or-not-trait"><a aria-hidden="true" tabindex="-1" href="#trait-or-not-trait"><span class="icon icon-link"></span></a>Trait or not trait?</h2>
<p>I'm a big fan of <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Clean Architecture</a>, and coming from a background of <code>go</code>, when I think of using <code>rust</code> to write a gRPC service, I came up with the following folder structure in <code>/src</code>:</p>
<pre><code class="code-highlight"><span class="code-line">/controller
</span><span class="code-line">/entity
</span><span class="code-line">/repository
</span><span class="code-line">/usecase
</span><span class="code-line">main.rs
</span><span class="code-line">controller.rs
</span><span class="code-line">repository.rs
</span><span class="code-line">usecase.rs
</span></code></pre>
<p>For example, the <code>usecase.rs</code> file contains the trait <code>UseCase</code> and its implementation <code>UseCaseState</code>. Although the trait <code>UseCase</code> only has 1 implementation, I like to keep it as a trait for clearly showing all the interfaces of <code>UseCase</code>.</p>
<p>And at first I think I can do static dispatching with all the performance gain.</p>
<p>The final code of <code>usecase.rs</code> looks like this:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>repository<span class="token punctuation">::</span></span><span class="token class-name">Repository</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">async_trait<span class="token punctuation">::</span></span>async_trait<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token module-declaration namespace">delete</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token module-declaration namespace">get</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token module-declaration namespace">update</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attribute attr-name">#[async_trait]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">UseCase</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token comment">//get something</span>
</span><span class="code-line">    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token comment">//update something</span>
</span><span class="code-line">    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token comment">//delete something</span>
</span><span class="code-line">    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">UseCaseState</span><span class="token operator">&lt;</span><span class="token class-name">Repository</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    repo<span class="token punctuation">:</span> <span class="token class-name">Repository</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Repository</span><span class="token operator">&gt;</span> <span class="token class-name">UseCaseState</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>repo<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">UseCaseState</span> <span class="token punctuation">{</span> repo<span class="token punctuation">,</span> client <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attribute attr-name">#[async_trait]</span>
</span><span class="code-line"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">UseCase</span> <span class="token keyword">for</span> <span class="token class-name">UseCaseState</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token keyword">where</span>
</span><span class="code-line">    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Repository</span> <span class="token operator">+</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">get_uc</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">update_uc</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">delete_uc</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>I want to make the code more readable, so I separate the <code>UseCase</code> implementation into multiple files in <code>/usecase</code> folder, containing the <code>get_uc</code>, <code>update_uc</code> and <code>delete_uc</code> functions. You can see them from the three <code>mod</code> lines at the beginning.</p>
<p>I must say this results in a lot of boilerplate code.</p>
<p>And I am only a beginner of <code>rust</code>, it is not pleasant to write the trait bounds and lifetime specifier for generic in trait implementation.</p>
<p>The code without trait:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>repository<span class="token punctuation">::</span></span><span class="token class-name">RepositoryState</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token module-declaration namespace">delete</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token module-declaration namespace">get</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token module-declaration namespace">update</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">UseCaseState</span> <span class="token punctuation">{</span>
</span><span class="code-line">    repo<span class="token punctuation">:</span> <span class="token class-name">RepositoryState</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">UseCaseState</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>repo<span class="token punctuation">:</span> <span class="token class-name">RepositoryState</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">UseCaseState</span> <span class="token punctuation">{</span> repo<span class="token punctuation">,</span> client <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>I also tried <code>dynamic dispatching</code>, with some struggle on the trait bound and lifetime(no surprise). Comparing the build size, it's almost identical to the image with no trait(with no surprise again).</p>
<p>To me, I can see no benefits of using trait(especially static dispatching) with only 1 implementation. I think now I can only rely on my IDE to check all the implementations of a struct.</p>
<h2 id="tiny-problems-with-rust-analyzer-and-vscode"><a aria-hidden="true" tabindex="-1" href="#tiny-problems-with-rust-analyzer-and-vscode"><span class="icon icon-link"></span></a>Tiny problems with Rust Analyzer and VSCode</h2>
<ul>
<li>code navigation</li>
</ul>
<p>When generating <code>rust</code> code from <code>proto</code> file, I utilize <code>tonic</code> with <code>build.rs</code>. The default location for the generated code will be somewhere like <code>target/debug/build/your_project_name-xxxxxxx/out/proto_package_name.rs</code>.</p>
<p>Since I'm a beginner at <code>rust</code>, I have the urge to look at the generated code, but <code>rust analyzer</code> will disappoint me as it always directs me to the <code>include!</code> clause. As stated in this <a href="https://github.com/rust-lang/rust-analyzer/issues/3767">issue</a>. (+1 for <code>CLion</code>)</p>
<ul>
<li>code completion</li>
</ul>
<p><code>rust analyzer</code> can't auto-implement missing members of an async trait. Check this <a href="https://github.com/rust-lang/rust-analyzer/issues/13595">issue</a>. (+1 for <code>CLion</code>)</p>
<h2 id="interceptors"><a aria-hidden="true" tabindex="-1" href="#interceptors"><span class="icon icon-link"></span></a>Interceptors</h2>
<p>I can't find any ecosystem of interceptors like <a href="https://github.com/grpc-ecosystem/go-grpc-middleware"><code>go-grpc-middleware</code></a>. Although there are some crates providing functions for <code>tracing</code> and <code>metrics</code>, I think they are not ready to use like the <code>go</code> version above.</p>
<p>In a use case, I want to check multiple metadata in the request. I come up with some code like this:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MyExtension</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> user_id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">pub</span> user_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">unary_interceptor</span><span class="token punctuation">(</span><span class="token keyword">mut</span> req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Status</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> m <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    req<span class="token punctuation">.</span><span class="token function">extensions_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">MyExtension</span> <span class="token punctuation">{</span>
</span><span class="code-line">        user_id<span class="token punctuation">:</span> m
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user-id"</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">unwrap_or_status_err</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token function">internal</span><span class="token punctuation">(</span><span class="token string">"user-id is missing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">to_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">unwrap_or_status_err</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token function">internal</span><span class="token punctuation">(</span><span class="token string">"user-id is invalid"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        user_name<span class="token punctuation">:</span> m
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user-name"</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">unwrap_or_status_err</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token function">internal</span><span class="token punctuation">(</span><span class="token string">"user-name is missing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">to_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">unwrap_or_status_err</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token function">internal</span><span class="token punctuation">(</span><span class="token string">"user-name is invalid"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">trait</span> <span class="token type-definition class-name">UnwrapOrErr</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function-definition function">unwrap_or_status_err</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> err<span class="token punctuation">:</span> <span class="token class-name">Status</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Status</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">UnwrapOrErr</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function-definition function">unwrap_or_status_err</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> err<span class="token punctuation">:</span> <span class="token class-name">Status</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Status</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">E</span><span class="token operator">&gt;</span> <span class="token class-name">UnwrapOrErr</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">E</span><span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token keyword">where</span>
</span><span class="code-line">    <span class="token class-name">E</span><span class="token punctuation">:</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function-definition function">unwrap_or_status_err</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> err<span class="token punctuation">:</span> <span class="token class-name">Status</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Status</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Ok</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<h2 id="logging"><a aria-hidden="true" tabindex="-1" href="#logging"><span class="icon icon-link"></span></a>logging</h2>
<p>Show you the code:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">tower_http<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token namespace">trace<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">DefaultOnResponse</span><span class="token punctuation">,</span> <span class="token class-name">TraceLayer</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token class-name">LatencyUnit</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">hyper<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Body</span><span class="token punctuation">,</span> <span class="token class-name">Request</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">tracing<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Level</span><span class="token punctuation">,</span> <span class="token class-name">Span</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token namespace">tracing_subscriber<span class="token punctuation">::</span></span><span class="token function">fmt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token comment">//this is an optional feature of tracing-subscriber</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">with_env_filter</span><span class="token punctuation">(</span><span class="token string">"tower_http=info"</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> layer <span class="token operator">=</span> <span class="token namespace">tower<span class="token punctuation">::</span></span><span class="token class-name">ServiceBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">layer</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">TraceLayer</span><span class="token punctuation">::</span><span class="token function">new_for_grpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token comment">//.make_span_with(DefaultMakeSpan::new().include_headers(true))</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">on_request</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>request<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">Body</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> _span<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Span</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token namespace">tracing<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"started {}"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">on_response</span><span class="token punctuation">(</span>
</span><span class="code-line">                    <span class="token class-name">DefaultOnResponse</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">level</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">::</span><span class="token constant">INFO</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">latency_unit</span><span class="token punctuation">(</span><span class="token class-name">LatencyUnit</span><span class="token punctuation">::</span><span class="token class-name">Micros</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">layer</span><span class="token punctuation">(</span><span class="token namespace">tonic<span class="token punctuation">::</span>service<span class="token punctuation">::</span></span><span class="token function">interceptor</span><span class="token punctuation">(</span>unary_interceptor<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Server</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">layer</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">add_service</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span></code></pre>
<h2 id="testing"><a aria-hidden="true" tabindex="-1" href="#testing"><span class="icon icon-link"></span></a>Testing</h2>
<p>not so good! <a href="https://github.com/rust-lang/rust-analyzer/issues/3601">https://github.com/rust-lang/rust-analyzer/issues/3601</a></p>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><span class="icon icon-link"></span></a>Conclusion</h2>
<p>I like <code>rust</code>, the <code>type</code> system is powerful, <code>async</code> is fun to learn, <code>log</code> is pleasant to use.</p>
<p>But when I write <code>rust</code>, I must think about the program itself(like the borrowing rule) and the business logic, when I write <code>go</code>, business logic is all I need to concern about. Maybe it's just I'm a beginner at <code>rust</code>, but the ecosystem will be my first thing to check next time I'm thinking about using <code>rust</code> in a gRPC service.</p><!--/qv--><!--/qv--></article></div><!--/qv--><!--/qv--></main></div><!--/qv--><script>(async(t,n)=>{var s;if(!window._qcs&&history.scrollRestoration==="manual"){window._qcs=!0;const c=(s=history.state)==null?void 0:s._qCityScroll;c&&window.scrollTo(c.x,c.y);const o=document.currentScript;(await import(t))[n](o)}})('/build/q-61e731e2.js','s_DyVc0YBIqQU');</script><!--/qv--><!--/qv--><!--qv q:key=35_2--><script q:key="1Z_0">((s,a,i,r)=>{i=(e,t)=>{t=document.querySelector("[q\\:base]"),t&&a.active&&a.active.postMessage({type:"qprefetch",base:t.getAttribute("q:base"),...e})},document.addEventListener("qprefetch",e=>{const t=e.detail;a?i(t):t.bundles&&s.push(...t.bundles)}),navigator.serviceWorker.register("/service-worker.js").then(e=>{r=()=>{a=e,i({bundles:s})},e.installing?e.installing.addEventListener("statechange",t=>{t.target.state=="activated"&&r()}):e.active&&r()}).catch(e=>console.error(e))})([])</script><!--/qv--></body><!--/qv--><!--/qv--><!--/qv--><script type="qwik/json">{"refs":{},"ctx":{},"objs":[],"subs":[]}</script></html>