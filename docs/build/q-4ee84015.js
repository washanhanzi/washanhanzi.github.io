import{h as a,k as l,m as s,x as t}from"./q-ff4a3c43.js";const r=[{text:"A short journey into gRPC with Rust",id:"a-short-journey-into-grpc-with-rust",level:1},{text:"Trait or not trait?",id:"trait-or-not-trait",level:2},{text:"Tiny problems with Rust Analyzer and VSCode",id:"tiny-problems-with-rust-analyzer-and-vscode",level:2},{text:"Interceptors",id:"interceptors",level:2},{text:"logging",id:"logging",level:2},{text:"Testing",id:"testing",level:2},{text:"Conclusion",id:"conclusion",level:2}],p={title:"A short journey into gRPC with Rust",meta:[],styles:[],links:[],frontmatter:{}},d={title:"A short journey into gRPC with Rust"};function c(e){const n=Object.assign({h1:"h1",a:"a",span:"span",p:"p",code:"code",h2:"h2",pre:"pre",ul:"ul",li:"li"},e.components);return s(t,{children:[s(n.h1,{id:"a-short-journey-into-grpc-with-rust",children:[s(n.a,{"aria-hidden":"true",tabindex:"-1",href:"#a-short-journey-into-grpc-with-rust",children:s(n.span,{class:"icon icon-link"})}),"A short journey into gRPC with Rust"]}),`
`,s(n.p,{children:["I use ",s(n.code,{children:"tokio"})," and ",s(n.code,{children:"seaORM"})," to build a simple CRUD gRPC app. Here is what I got from the process."]}),`
`,s(n.h2,{id:"trait-or-not-trait",children:[s(n.a,{"aria-hidden":"true",tabindex:"-1",href:"#trait-or-not-trait",children:s(n.span,{class:"icon icon-link"})}),"Trait or not trait?"]}),`
`,s(n.p,{children:["I'm a big fan of ",s(n.a,{href:"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html",children:"Clean Architecture"}),", and coming from a background of ",s(n.code,{children:"go"}),", when I think of using ",s(n.code,{children:"rust"})," to write a gRPC service, I came up with the following folder structure in ",s(n.code,{children:"/src"}),":"]}),`
`,s(n.pre,{children:s(n.code,{class:"code-highlight",children:[s(n.span,{class:"code-line",children:`/controller
`}),s(n.span,{class:"code-line",children:`/entity
`}),s(n.span,{class:"code-line",children:`/repository
`}),s(n.span,{class:"code-line",children:`/usecase
`}),s(n.span,{class:"code-line",children:`main.rs
`}),s(n.span,{class:"code-line",children:`controller.rs
`}),s(n.span,{class:"code-line",children:`repository.rs
`}),s(n.span,{class:"code-line",children:`usecase.rs
`})]})}),`
`,s(n.p,{children:["For example, the ",s(n.code,{children:"usecase.rs"})," file contains the trait ",s(n.code,{children:"UseCase"})," and its implementation ",s(n.code,{children:"UseCaseState"}),". Although the trait ",s(n.code,{children:"UseCase"})," only has 1 implementation, I like to keep it as a trait for clearly showing all the interfaces of ",s(n.code,{children:"UseCase"}),"."]}),`
`,s(n.p,{children:"And at first I think I can do static dispatching with all the performance gain."}),`
`,s(n.p,{children:["The final code of ",s(n.code,{children:"usecase.rs"})," looks like this:"]}),`
`,s(n.pre,{class:"language-rust",children:s(n.code,{class:"language-rust code-highlight",children:[s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"use"})," ",s(n.span,{class:"token keyword",children:"crate"}),s(n.span,{class:"token module-declaration namespace",children:[s(n.span,{class:"token punctuation",children:"::"}),"repository",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token class-name",children:"Repository"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"use"})," ",s(n.span,{class:"token namespace",children:["anyhow",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"use"})," ",s(n.span,{class:"token namespace",children:["async_trait",s(n.span,{class:"token punctuation",children:"::"})]}),"async_trait",s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"mod"})," ",s(n.span,{class:"token module-declaration namespace",children:"delete"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"mod"})," ",s(n.span,{class:"token module-declaration namespace",children:"get"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"mod"})," ",s(n.span,{class:"token module-declaration namespace",children:"update"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token attribute attr-name",children:"#[async_trait]"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"pub"})," ",s(n.span,{class:"token keyword",children:"trait"})," ",s(n.span,{class:"token type-definition class-name",children:"UseCase"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["	",s(n.span,{class:"token comment",children:"//get something"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"get"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," key",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"String"}),s(n.span,{class:"token operator",children:">"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:["	",s(n.span,{class:"token comment",children:"//update something"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"update"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," k",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:","})," v",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:">"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:["	",s(n.span,{class:"token comment",children:"//delete something"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"delete"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," k",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:">"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"pub"})," ",s(n.span,{class:"token keyword",children:"struct"})," ",s(n.span,{class:"token type-definition class-name",children:"UseCaseState"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"Repository"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    repo",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"Repository"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"impl"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"Repository"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token class-name",children:"UseCaseState"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"pub"})," ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"new"}),s(n.span,{class:"token punctuation",children:"("}),"repo",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token keyword",children:"Self"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token class-name",children:"UseCaseState"})," ",s(n.span,{class:"token punctuation",children:"{"})," repo",s(n.span,{class:"token punctuation",children:","})," client ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token attribute attr-name",children:"#[async_trait]"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"impl"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token class-name",children:"UseCase"})," ",s(n.span,{class:"token keyword",children:"for"})," ",s(n.span,{class:"token class-name",children:"UseCaseState"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"where"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"Repository"})," ",s(n.span,{class:"token operator",children:"+"})," ",s(n.span,{class:"token class-name",children:"Sync"})," ",s(n.span,{class:"token operator",children:"+"})," ",s(n.span,{class:"token class-name",children:"Send"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"get"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," key",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"String"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token class-name",children:"Ok"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"get_uc"}),s(n.span,{class:"token punctuation",children:"("}),"key",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token keyword",children:"await"}),s(n.span,{class:"token operator",children:"?"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"update"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," k",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:","})," v",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token class-name",children:"Ok"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"update_uc"}),s(n.span,{class:"token punctuation",children:"("}),"k",s(n.span,{class:"token punctuation",children:","})," v",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token keyword",children:"await"}),s(n.span,{class:"token operator",children:"?"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"delete"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," k",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token keyword",children:"str"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token class-name",children:"Ok"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"delete_uc"}),s(n.span,{class:"token punctuation",children:"("}),"k",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token keyword",children:"await"}),s(n.span,{class:"token operator",children:"?"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]})]})}),`
`,s(n.p,{children:["I want to make the code more readable, so I separate the ",s(n.code,{children:"UseCase"})," implementation into multiple files in ",s(n.code,{children:"/usecase"})," folder, containing the ",s(n.code,{children:"get_uc"}),", ",s(n.code,{children:"update_uc"})," and ",s(n.code,{children:"delete_uc"})," functions. You can see them from the three ",s(n.code,{children:"mod"})," lines at the beginning."]}),`
`,s(n.p,{children:"I must say this results in a lot of boilerplate code."}),`
`,s(n.p,{children:["And I am only a beginner of ",s(n.code,{children:"rust"}),", it is not pleasant to write the trait bounds and lifetime specifier for generic in trait implementation."]}),`
`,s(n.p,{children:"The code without trait:"}),`
`,s(n.pre,{class:"language-rust",children:s(n.code,{class:"language-rust code-highlight",children:[s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"use"})," ",s(n.span,{class:"token keyword",children:"crate"}),s(n.span,{class:"token module-declaration namespace",children:[s(n.span,{class:"token punctuation",children:"::"}),"repository",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token class-name",children:"RepositoryState"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"mod"})," ",s(n.span,{class:"token module-declaration namespace",children:"delete"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"mod"})," ",s(n.span,{class:"token module-declaration namespace",children:"get"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"mod"})," ",s(n.span,{class:"token module-declaration namespace",children:"update"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"pub"})," ",s(n.span,{class:"token keyword",children:"struct"})," ",s(n.span,{class:"token type-definition class-name",children:"UseCaseState"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    repo",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"RepositoryState"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"impl"})," ",s(n.span,{class:"token class-name",children:"UseCaseState"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"pub"})," ",s(n.span,{class:"token keyword",children:"async"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"new"}),s(n.span,{class:"token punctuation",children:"("}),"repo",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"RepositoryState"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token keyword",children:"Self"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token class-name",children:"UseCaseState"})," ",s(n.span,{class:"token punctuation",children:"{"})," repo",s(n.span,{class:"token punctuation",children:","})," client ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]})]})}),`
`,s(n.p,{children:["I also tried ",s(n.code,{children:"dynamic dispatching"}),", with some struggle on the trait bound and lifetime(no surprise). Comparing the build size, it's almost identical to the image with no trait(with no surprise again)."]}),`
`,s(n.p,{children:"To me, I can see no benefits of using trait(especially static dispatching) with only 1 implementation. I think now I can only rely on my IDE to check all the implementations of a struct."}),`
`,s(n.h2,{id:"tiny-problems-with-rust-analyzer-and-vscode",children:[s(n.a,{"aria-hidden":"true",tabindex:"-1",href:"#tiny-problems-with-rust-analyzer-and-vscode",children:s(n.span,{class:"icon icon-link"})}),"Tiny problems with Rust Analyzer and VSCode"]}),`
`,s(n.ul,{children:[`
`,s(n.li,{children:"code navigation"}),`
`]}),`
`,s(n.p,{children:["When generating ",s(n.code,{children:"rust"})," code from ",s(n.code,{children:"proto"})," file, I utilize ",s(n.code,{children:"tonic"})," with ",s(n.code,{children:"build.rs"}),". The default location for the generated code will be somewhere like ",s(n.code,{children:"target/debug/build/your_project_name-xxxxxxx/out/proto_package_name.rs"}),"."]}),`
`,s(n.p,{children:["Since I'm a beginner at ",s(n.code,{children:"rust"}),", I have the urge to look at the generated code, but ",s(n.code,{children:"rust analyzer"})," will disappoint me as it always directs me to the ",s(n.code,{children:"include!"})," clause. As stated in this ",s(n.a,{href:"https://github.com/rust-lang/rust-analyzer/issues/3767",children:"issue"}),". (+1 for ",s(n.code,{children:"CLion"}),")"]}),`
`,s(n.ul,{children:[`
`,s(n.li,{children:"code completion"}),`
`]}),`
`,s(n.p,{children:[s(n.code,{children:"rust analyzer"})," can't auto-implement missing members of an async trait. Check this ",s(n.a,{href:"https://github.com/rust-lang/rust-analyzer/issues/13595",children:"issue"}),". (+1 for ",s(n.code,{children:"CLion"}),")"]}),`
`,s(n.h2,{id:"interceptors",children:[s(n.a,{"aria-hidden":"true",tabindex:"-1",href:"#interceptors",children:s(n.span,{class:"icon icon-link"})}),"Interceptors"]}),`
`,s(n.p,{children:["I can't find any ecosystem of interceptors like ",s(n.a,{href:"https://github.com/grpc-ecosystem/go-grpc-middleware",children:s(n.code,{children:"go-grpc-middleware"})}),". Although there are some crates providing functions for ",s(n.code,{children:"tracing"})," and ",s(n.code,{children:"metrics"}),", I think they are not ready to use like the ",s(n.code,{children:"go"})," version above."]}),`
`,s(n.p,{children:"In a use case, I want to check multiple metadata in the request. I come up with some code like this:"}),`
`,s(n.pre,{class:"language-rust",children:s(n.code,{class:"language-rust code-highlight",children:[s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"pub"})," ",s(n.span,{class:"token keyword",children:"struct"})," ",s(n.span,{class:"token type-definition class-name",children:"MyExtension"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"pub"})," user_id",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"String"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"pub"})," user_name",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"String"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"pub"})," ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"unary_interceptor"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token keyword",children:"mut"})," req",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"Request"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:">"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"Request"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:">"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"let"})," m ",s(n.span,{class:"token operator",children:"="})," req",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"metadata"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"clone"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:["    req",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"extensions_mut"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"insert"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"MyExtension"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        user_id",s(n.span,{class:"token punctuation",children:":"}),` m
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"get"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"user-id"'}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"unwrap_or_status_err"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"internal"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"user-id is missing"'}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:"?"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"to_str"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"unwrap_or_status_err"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"internal"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"user-id is invalid"'}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:"?"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"to_string"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["        user_name",s(n.span,{class:"token punctuation",children:":"}),` m
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"get"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"user-name"'}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"unwrap_or_status_err"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"internal"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"user-name is missing"'}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:"?"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"to_str"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"unwrap_or_status_err"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"internal"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"user-name is invalid"'}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token operator",children:"?"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"to_string"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token class-name",children:"Ok"}),s(n.span,{class:"token punctuation",children:"("}),"req",s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"trait"})," ",s(n.span,{class:"token type-definition class-name",children:"UnwrapOrErr"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"unwrap_or_status_err"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," err",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token operator",children:">"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"impl"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token class-name",children:"UnwrapOrErr"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token keyword",children:"for"})," ",s(n.span,{class:"token class-name",children:"Option"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"unwrap_or_status_err"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," err",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token keyword",children:"match"})," ",s(n.span,{class:"token keyword",children:"self"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token class-name",children:"Some"}),s(n.span,{class:"token punctuation",children:"("}),"val",s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token operator",children:"=>"})," ",s(n.span,{class:"token class-name",children:"Ok"}),s(n.span,{class:"token punctuation",children:"("}),"val",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token class-name",children:"None"})," ",s(n.span,{class:"token operator",children:"=>"})," ",s(n.span,{class:"token keyword",children:"return"})," ",s(n.span,{class:"token class-name",children:"Err"}),s(n.span,{class:"token punctuation",children:"("}),"err",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"impl"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"E"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token class-name",children:"UnwrapOrErr"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token keyword",children:"for"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"E"}),s(n.span,{class:"token operator",children:">"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"where"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token class-name",children:"E"}),s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token namespace",children:["fmt",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token class-name",children:"Debug"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"fn"})," ",s(n.span,{class:"token function-definition function",children:"unwrap_or_status_err"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token keyword",children:"self"}),s(n.span,{class:"token punctuation",children:","})," err",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token punctuation",children:"->"})," ",s(n.span,{class:"token class-name",children:"Result"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"T"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"Status"}),s(n.span,{class:"token operator",children:">"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token keyword",children:"match"})," ",s(n.span,{class:"token keyword",children:"self"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token class-name",children:"Ok"}),s(n.span,{class:"token punctuation",children:"("}),"val",s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token operator",children:"=>"})," ",s(n.span,{class:"token class-name",children:"Ok"}),s(n.span,{class:"token punctuation",children:"("}),"val",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token class-name",children:"Err"}),s(n.span,{class:"token punctuation",children:"("}),"e",s(n.span,{class:"token punctuation",children:")"})," ",s(n.span,{class:"token operator",children:"=>"})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["                ",s(n.span,{class:"token namespace",children:["log",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token macro property",children:"error!"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"{:?}"'}),s(n.span,{class:"token punctuation",children:","})," e",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:["                ",s(n.span,{class:"token keyword",children:"return"})," ",s(n.span,{class:"token class-name",children:"Err"}),s(n.span,{class:"token punctuation",children:"("}),"err",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token punctuation",children:"}"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),`
`]})]})}),`
`,s(n.h2,{id:"logging",children:[s(n.a,{"aria-hidden":"true",tabindex:"-1",href:"#logging",children:s(n.span,{class:"icon icon-link"})}),"logging"]}),`
`,s(n.p,{children:"Show you the code:"}),`
`,s(n.pre,{class:"language-rust",children:s(n.code,{class:"language-rust code-highlight",children:[s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"use"})," ",s(n.span,{class:"token namespace",children:["tower_http",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token namespace",children:["trace",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token punctuation",children:"{"}),s(n.span,{class:"token class-name",children:"DefaultOnResponse"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"TraceLayer"}),s(n.span,{class:"token punctuation",children:"}"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token class-name",children:"LatencyUnit"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token punctuation",children:"}"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"use"})," ",s(n.span,{class:"token namespace",children:["hyper",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token punctuation",children:"{"}),s(n.span,{class:"token class-name",children:"Body"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"Request"}),s(n.span,{class:"token punctuation",children:"}"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:[s(n.span,{class:"token keyword",children:"use"})," ",s(n.span,{class:"token namespace",children:["tracing",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token punctuation",children:"{"}),s(n.span,{class:"token class-name",children:"Level"}),s(n.span,{class:"token punctuation",children:","})," ",s(n.span,{class:"token class-name",children:"Span"}),s(n.span,{class:"token punctuation",children:"}"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token namespace",children:["tracing_subscriber",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token function",children:"fmt"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token comment",children:"//this is an optional feature of tracing-subscriber"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"with_env_filter"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"tower_http=info"'}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"init"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token keyword",children:"let"})," layer ",s(n.span,{class:"token operator",children:"="})," ",s(n.span,{class:"token namespace",children:["tower",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token class-name",children:"ServiceBuilder"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"new"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"timeout"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"Duration"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"from_secs"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token number",children:"10"}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"layer"}),s(n.span,{class:"token punctuation",children:"("}),`
`]}),s(n.span,{class:"code-line",children:["            ",s(n.span,{class:"token class-name",children:"TraceLayer"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"new_for_grpc"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["                ",s(n.span,{class:"token comment",children:"//.make_span_with(DefaultMakeSpan::new().include_headers(true))"}),`
`]}),s(n.span,{class:"code-line",children:["                ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"on_request"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token closure-params",children:[s(n.span,{class:"token closure-punctuation punctuation",children:"|"}),"request",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token class-name",children:"Request"}),s(n.span,{class:"token operator",children:"<"}),s(n.span,{class:"token class-name",children:"Body"}),s(n.span,{class:"token operator",children:">"}),s(n.span,{class:"token punctuation",children:","})," _span",s(n.span,{class:"token punctuation",children:":"})," ",s(n.span,{class:"token operator",children:"&"}),s(n.span,{class:"token class-name",children:"Span"}),s(n.span,{class:"token closure-punctuation punctuation",children:"|"})]})," ",s(n.span,{class:"token punctuation",children:"{"}),`
`]}),s(n.span,{class:"code-line",children:["                    ",s(n.span,{class:"token namespace",children:["tracing",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token macro property",children:"info!"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token string",children:'"started {}"'}),s(n.span,{class:"token punctuation",children:","})," request",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"uri"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"path"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["                ",s(n.span,{class:"token punctuation",children:"}"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["                ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"on_response"}),s(n.span,{class:"token punctuation",children:"("}),`
`]}),s(n.span,{class:"code-line",children:["                    ",s(n.span,{class:"token class-name",children:"DefaultOnResponse"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"new"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["                        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"level"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"Level"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token constant",children:"INFO"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["                        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"latency_unit"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token class-name",children:"LatencyUnit"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token class-name",children:"Micros"}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["                ",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:","}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"layer"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token namespace",children:["tonic",s(n.span,{class:"token punctuation",children:"::"}),"service",s(n.span,{class:"token punctuation",children:"::"})]}),s(n.span,{class:"token function",children:"interceptor"}),s(n.span,{class:"token punctuation",children:"("}),"unary_interceptor",s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"into_inner"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`}),s(n.span,{class:"code-line",children:["    ",s(n.span,{class:"token class-name",children:"Server"}),s(n.span,{class:"token punctuation",children:"::"}),s(n.span,{class:"token function",children:"builder"}),s(n.span,{class:"token punctuation",children:"("}),s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"layer"}),s(n.span,{class:"token punctuation",children:"("}),"layer",s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"add_service"}),s(n.span,{class:"token punctuation",children:"("}),"svc",s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token function",children:"serve"}),s(n.span,{class:"token punctuation",children:"("}),"addr",s(n.span,{class:"token punctuation",children:")"}),`
`]}),s(n.span,{class:"code-line",children:["        ",s(n.span,{class:"token punctuation",children:"."}),s(n.span,{class:"token keyword",children:"await"}),s(n.span,{class:"token operator",children:"?"}),s(n.span,{class:"token punctuation",children:";"}),`
`]}),s(n.span,{class:"code-line",children:`
`})]})}),`
`,s(n.h2,{id:"testing",children:[s(n.a,{"aria-hidden":"true",tabindex:"-1",href:"#testing",children:s(n.span,{class:"icon icon-link"})}),"Testing"]}),`
`,s(n.p,{children:["not so good! ",s(n.a,{href:"https://github.com/rust-lang/rust-analyzer/issues/3601",children:"https://github.com/rust-lang/rust-analyzer/issues/3601"})]}),`
`,s(n.h2,{id:"conclusion",children:[s(n.a,{"aria-hidden":"true",tabindex:"-1",href:"#conclusion",children:s(n.span,{class:"icon icon-link"})}),"Conclusion"]}),`
`,s(n.p,{children:["I like ",s(n.code,{children:"rust"}),", the ",s(n.code,{children:"type"})," system is powerful, ",s(n.code,{children:"async"})," is fun to learn, ",s(n.code,{children:"log"})," is pleasant to use."]}),`
`,s(n.p,{children:["But when I write ",s(n.code,{children:"rust"}),", I must think about the program itself(like the borrowing rule) and the business logic, when I write ",s(n.code,{children:"go"}),", business logic is all I need to concern about. Maybe it's just I'm a beginner at ",s(n.code,{children:"rust"}),", but the ecosystem will be my first thing to check next time I'm thinking about using ",s(n.code,{children:"rust"})," in a gRPC service."]})]})}function i(e={}){const{wrapper:n}=e.components||{};return n?s(n,Object.assign({},e,{children:s(c,e)})):c(e)}const h=()=>a(l,{children:a(i,{},3,null)},3,"v3Kz-9vL");export{h as default,d as frontmatter,p as head,r as headings};
